'use strict';

var _webpack = require('webpack');

var _webpack2 = _interopRequireDefault(_webpack);

var _webpack3 = require('../webpack.config');

var _webpack4 = _interopRequireDefault(_webpack3);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var directory = process.argv[2];
var stage = process.argv[3];
var program = { directory: directory };
var compilerConfig = (0, _webpack4.default)(program, directory, stage);

console.log(stage, process.pid);
(0, _webpack2.default)(compilerConfig.resolve()).run(function (error, stats) {
  if (error) {
    console.log({ error: error });
    process.exit(1);
  }

  if (stats.hasErrors()) {
    console.log({ error: stats.toJson().errors });
    process.exit(1);
  }

  process.exit(0);
});